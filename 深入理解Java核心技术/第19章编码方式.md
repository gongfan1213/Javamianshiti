### 第19章 编码方式
#### 19.1 什么是ASCII和Unicode
### 1. 字符编码和ASCII
电报在传递过程中，发报员用电键发出长短不一的电码，收报员听到电报机发出滴滴答答声。电报声由“滴”和“答”组成，“答”声是“滴”的三倍长。发报员将情报转成电码声，收报员再译码，此为字符编码和解码过程。谍战剧中情报转电报声常通过摩尔斯电码，它通过不同排列表达英文字母、数字和标点符号。

摩尔斯电码由点和划（短和长电脉冲）组成，点为基本单位，一划等于三点长度，对应电报“滴”“答” 。国际摩尔斯电码如图19 - 1所示。

计算机只认0和1，人类文字多样，需字符编码将其转换成计算机能识别的0、1字符。

**国际摩尔斯电码**

1. 一点的长度是一个单位。

2. 一划是三个单位。


3. 在一个字母中点划之间的间隔是一点。

4. 两个字母之间的间隔是三点（一划）。

5. 两个单词之间的间隔是七点。

![image](https://github.com/user-attachments/assets/cf54bc16-7187-4bf0-9d1b-86b45f7d2d12)



字符编码（Character Encoding）是一套法则，将自然语言字符集（如字母表等）与其他集合（如号码、电脉冲）配对。

20世纪60年代，美国制定ASCII码（American Standard Code for Information Interchange，美国信息交换标准代码 ），对英语字符与二进制位关系做统一规定，沿用至今。它是基于拉丁字母的计算机编码系统，用于显示现代英语，共128个字符。标准ASCII码也叫基础ASCII码，用7位二进制数（第8位为0）表示大写小写字母、数字0 - 9、标点符号及美式英语特殊控制字符。
 - 0 - 31及127（共33个）是控制字符或通信专用字符 ，如LF（换行）、CR（回车）等。ASCII值为8、9、10和13分别转换为退格、制表、换行和回车字符，无特定图形显示，依应用程序影响文本显示。
 - 32 - 126（共95个）是字符（32是空格） ，48 - 57为0 - 9阿拉伯数字，65 - 90为26个大写英文字母，97 - 122为26个小写英文字母，其余为标点符号、运算符号等。

因ASCII码只有128个字符，无法表示世界其他文字，需更全面字符编码。

### 2. Unicode
Unicode（中文名：万国码、国际码、统一码、单一码 ）是计算机科学领域业界标准，整理编码世界大部分文字系统，让计算机更简便呈现和处理文字。

Unicode不断增修，2019年5月公布的v12.1版本新增日本新年号合字（上令下和）。它在计算机软件国际化与本地化广泛应用，如XML、Java编程语言及现代操作系统都采用其编码。Unicode是通用字符集，包含世界大部分文字，可表示中文。

![image](https://github.com/user-attachments/assets/06ccc012-2f8f-4c3b-b4ed-bb5484ef1a99)


#### 19.2 有了Unicode为什么还需要UTF - 8
Unicode统一世界字符编码，但未规定存储方式。若统一规定，每个符号需三或四个字节表示，英文字母在ASCII码中用一个字节，按此规定会使文本文件增大，造成存储浪费。

为解决问题，出现通用转换格式（Unicode Transformation Format，UTF ）字符集，常见有UTF - 7、UTF - 7.5、UTF - 8、UTF - 16和UTF - 32 。
 - UTF - 8用1 - 4字节为字符编码。
 - UTF - 16用2或4字节为字符编码。 
 - UTF - 32用4字节为字符编码。

UTF - 8、UTF - 16等是Unicode的实现方式。如中文字符“我” ，Unicode编码是“\u6211” ，在UTF - 8和UTF - 16等实现方式下存储方式不同。UTF - 8用可变长度字节存储Unicode字符，ASCII字母用1字节，重音文字等用2字节，常用汉字用3字节，辅助平面字符用4字节。

#### 19.3 有了UTF - 8为什么还需要GBK
UTF - 8是Unicode的一种实现，含世界所有文字编码，采用1 - 4字节编码。先纳入字符优先用1字节、2字节存储，后纳入的可能需3字节或4字节，占用存储空间大。

常用汉字在UTF - 8中用3字节编码，若有一种只含中文和ASCII的编码，可能2字节就够。对于只服务特定国家或地区的网站（如中国网站 ），多出现简体字、繁体字及英文字符，少出现日语、韩语。

原国家标准总局1981年制定GB 2312 - 80编码 ，收录简体中文字符集。微软利用其未使用编码空间，收录GB 13000.1 - 93全部字符制定GBK编码。

有标准中文字符集后，纯中文网站用此编码可节省存储空间。常用中文编码有GBK、GB2312、GB18030等，最常用GBK 。
 - **GB2312（1980年）**：16位字符集，收录6763个简体汉字和682个符号，共7445个字符。优点是适用于简体中文环境，是中国国家标准，通行于中国大陆地区、新加坡；缺点是不兼容繁体中文，汉字集合过少。
 - **GBK（1995年）**：16位字符集，收录21003个汉字和883个符号，共21886个字符。优点是适用于简繁中文共存环境，为简体Windows使用，向下兼容GB2312，向上支持ISO - 10646国际标准，所有字符可映射到Unicode 2.0上；缺点是不属于官方标准，很多搜索引擎对GBK汉字支持不好。 
 - **GB18030（2000年）**：32位字符集，收录27484个汉字，同时收录藏文、蒙文、维吾尔文等主要少数民族文字。优点是可收录所有文字和符号，是最新国家标准；缺点是目前支持软件较少。

#### 19.4 为什么会存在乱码
以发电报为例，发报员用“美式摩尔斯电码”转情报，收报员用“现代国际摩尔斯电码”破译，可能看不懂，此为乱码。计算机领域也类似，如中文字符用UTF - 8编码传输，对方用GBK解码，可能得到乱码内容。

以下代码示例：
```java
public static void main(String[] args) throws UnsupportedEncodingException {
    String s = "我爱中国！";
    byte[] bytes = s.getBytes(Charset.forName("GBK"));
    System.out.println("GBK编码，GBK解码：" + new String(bytes, "GBK"));
    System.out.println("GBK编码，GB18030解码：" + new String(bytes, "GB18030"));
    System.out.println("GBK编码，UTF - 8解码：" + new String(bytes, "UTF - 8"));
}
```
输出结果：
GBK编码，GBK解码：我爱中国！
GBK编码，GB18030解码：我爱中国！
GBK编码，UTF - 8解码：��!

GBK编码的中文字符用UTF - 8解码得到乱码。Unicode不断更新，新字符可能无法表示，软件系统未升级也会有此问题。如手机厂商新emoji表情，本机可显示，发其他品牌手机可能无法显示，因字符集不支持。

Unicode中用“�”（0xFFFD REPLACEMENT CHARACTER ）表示无法显示的字符，其十进制值65533 ，UTF - 8下十六进制形式是“0xEF 0xBF 0xBD”（三个字节 ） 。若两个连续字符无法显示，UTF - 8编码下十六进制值为：
0xEF 0xBF 0xBD
0xEF 0xBF 0xBD

放到GBK中解码，因GBK中一个汉字占2字节，结果为：
0xEF 0xBF，0xBD 0xEF，0xBF 0xBD
即：
0xEFBF
0xBDEF
0xBFBD
展示出来是锟（0xEFBF）、斤（0xBDEF）、拷（0xBFBD） 。所以看到锟斤拷，要想到UTF - 8和GBK转换问题。

还有“烫烫烫”和“屯屯屯”两组经典乱码，产生于Debug模式下Visual C对内存的初始化操作。Visual C把栈中新分配内存初始化为0xcc，把堆中新分配内存初始化为0xcd ，按字符打印就是烫和屯。 
